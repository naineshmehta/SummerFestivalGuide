(function(f){f.fn.wst=function(b){b=f.extend({backgroundColor:"333333",lightboxBackground:"cccccc",easing:"easeOutBack",animSpeed:1E3,rows:2,columns:4,randomicity:80,videoWidth:200,videoHeight:150,infoWidth:180,autoPlayVideo:!0,showVideoControls:!0,openLinkInNewWindow:!1,approxWidth:120,approxHeight:120,startDiscoverty:"Start your Discovery",xofy:"[x] of [y]",editable:!1,modulePath:"/dnn450/desktopmodules/ultramediagallery/"},b);return this.each(function(){function F(a){a="undefined"!=typeof a?a.substring(a.lastIndexOf(".")+
1,a.length).toLowerCase():!1;return"mp4"==a||"flv"==a?"v":"mp3"==a?"a":""!=a?"i":""}function y(a){if(s!=a){s=a;var t=c.find(".category");t.removeClass("current");f(t[a]).addClass("current");m.stop().animate({left:-1*m.width()},b.animSpeed,b.easing,function(){m.children(".media").hide()});R()}}function R(){var a=b.xofy,a=a.replace("[x]",1*s+1),a=a.replace("[y]",o.length);S.html(a);a=f(o[s]).children();C=-1;for(var t="",i=0;i<a.length;i++){var u=f(a[i]);if("i"==F(u.attr("data-url"))){C=i;t=u.attr("data-url");
break}}z.css("left",c.width());if(""!=t){var h=new Image;h.onload=function(){var a=z.children("img");a.attr("width",G.width());a.attr("height",G.height());a.attr("src",h.src);z.stop().animate({left:0},b.animSpeed,b.easing,T)};h.src=t}}function T(){for(var a=c.width()-A-b.approxWidth,h=parseInt(H.position().top)-A-b.approxHeight,i=!0,u=0,j=f(o[s]).children(),v=0;v<j.length;v++)if(v!=C){var p=Math.floor(u/b.columns),e=u%b.columns;if(p>=b.rows)break;var g=f(j[v]);if(g.attr("data-url")!=z.children("img").attr("url")){var q=
b.approxWidth,r=b.approxHeight,d=m.find("#media"+g.attr("data-umgid"));if(1>d.length){var d="<a id='media"+g.attr("data-umgid")+"' data-umgid='"+g.attr("data-umgid")+"' data-index='"+v+"' class='media",k=F(g.attr("data-url"));if("i"==k)d+="' href='"+g.attr("data-url")+"' target='_blank'",d+="'>",d+="<img alt='' src='"+g.attr("data-thumb")+"' />";else if("v"==k){q=b.videoWidth;r=b.videoHeight;d+=" richmedia'>";k="";if(U)i="true",b.autoPlayVideo||(i+="false"),k="<video id='img"+index+"' src='"+g.attr("data-url")+
"' type='video/mp4' width='"+b.videoWidth+"px' height='"+b.videoHeight+"px' autoplay='"+i+"' controls='controls' />";else{k="";if(!b.autoPlayVideo||!i)k+="&autoStart=False";b.showVideoControls&&(k+="&showControlBar=True");k="<object allowFullScreen='True' allowScriptAccess='always' allowNetworking='all' width='"+b.videoWidth+"' height='"+b.videoHeight+"'><param name='movie' value='"+b.modulePath+"SimpleVideo.swf' /><param name='allowFullScreen' value='true' /><param name='wmode' value='transparent' /><param name='flashvars' value='video="+
g.attr("data-url")+"&sender="+I+k+"' /><embed src='"+b.modulePath+"SimpleVideo.swf' type='application/x-shockwave-flash' allowFullScreen='True' allowScriptAccess='always' allowNetworking='all' width='"+b.videoWidth+"' height='"+b.videoHeight+"' wmode='transparent' flashvars='video="+g.attr("data-url")+"&sender="+I+k+"'></embed></object>"}d+=k;i=!1}else""==k&&0<g.children(".htmlcontent").length&&(d+="' href='javascript:void(0);' rel='"+g.attr("data-umgid")+"'",d+="'>",d+="<img alt='' src='"+g.attr("data-thumb")+
"' />");d+="<span class='title'><span class='titleinner'>"+g.attr("data-title")+"</span></span></a>";m.append(d);d=f(m.find(".media")[m.find(".media").length-1]);d.click(J)}else q=d.width(),r=d.height(),d.show();if(g.attr("data-position"))p=1*g.attr("data-position").split(",")[0],g=1*g.attr("data-position").split(",")[1];else if(g=e*K+(K-q)/2,p=p*L+(L-r)/2,0!=b.randomicity){r=B();for(e=0;(g+r<=A||g+r>a)&&!(5<=e);){r=B();e+=1}q=B();for(e=0;(p+q<=A||p+q>h)&&!(5<=e);){q=B();e+=1}g+=r;p+=q}d.css("top",
p).css("left",g);u++}}m.css("left",c.width());m.stop().animate({left:0},b.animSpeed,b.easing);if(b.editable){var l=c.children(".layoutMode"),n=c.children(".saveLayout");1>l.length?(c.append("<a class='layoutMode' href='javascript:void(0);'>Adjust Layout</a><a class='saveLayout'' href='javascript:void(0);' >Save New Layout</a>"),l=c.children(".layoutMode"),n=c.children(".saveLayout"),n.hide(),l.click(function(){var a=m.find(".media:visible");a.unbind("click");a.click(function(){return!1});a.css("cursor",
"move");a.draggable({disabled:!1});l.hide();n.show()}),n.click(function(){for(var a=m.children(".media:visible"),b="",c=0;c<a.length;c++){var d=f(a[c]);""!=b&&(b+="|");b+=d.attr("data-umgid")+":"+d.position().top+","+d.position().left}"function"!=typeof WST_SaveLayout?alert("This feature is not implemented."):WST_SaveLayout(b)})):(a=m.find(".media:visible"),n.hide(),l.show(),a.unbind("click"),a.click(J),a.css("cursor",""),a.draggable({disabled:!0}))}}function J(){var a=f(this);if(!a.hasClass("richmedia")){"undefined"!=
typeof UPG_onPhotoLoad&&UPG_onPhotoLoad(a.attr("data-umgid"));n.css("left",a.position().left+a.width()/2);n.css("top",a.position().top+a.height()/2);n.show();var c=f(f(o[s]).children()[a.attr("data-index")]);M=c.attr("data-title");D=c.attr("data-link");N=0<a.children(".description").length?c.children(".description").html():c.attr("data-description");if(a.attr("rel"))n.hide(),a=f(".photo[data-umgid*='"+a.attr("rel")+"']"),V(a.children(".htmlcontent").html());else{var i=new Image;i.onload=function(){n.hide();
e.stop().animate({top:0},b.animSpeed,b.easing);var a=i.width,c=0.9*e.width(),f=i.height,j=0.9*e.height(),c=Math.max(a/c,f/j),a=Math.round(a/c),f=Math.round(f/c);l.html("<img alt='' src='"+i.src+"' width='"+a+"' height='"+f+"' />");O();h.css("height",l.height());a+b.infoWidth<0.9*e.width()?(h.css("left",a),h.removeClass("withbg")):(h.css("left",a-b.infoWidth),h.addClass("withbg"));P()};i.src=a.attr("href")}return!1}}function B(){return 2*Math.random()*b.randomicity-b.randomicity}function O(){h.children(".title").html(M);
h.children(".description").html(N);D?(w.attr("href",D),w.show()):(w.attr("href",""),w.hide())}function P(){j.outerWidth(!0);j.width();var a=parseInt(h.css("left"))+h.width();j.css("width",a);j.width()<a&&j.css("width",a+a-j.width());j.css("left",(e.width()-j.outerWidth(!0))/2);j.css("top",(e.height()-j.outerHeight(!0))/2)}function V(a){e.stop().animate({top:0},b.animSpeed,b.easing);a=f(a);l.html("");l.append(a);O();h.css("height",l.height());h.css("left",a.width());h.removeClass("withbg");P()}function E(){e.stop().animate({top:-1*
e.height()},b.animSpeed,b.easing)}var c=f(this);c.children().hide();var o=c.find(".album");c.append("<div class='bglayer' style='background-color:#"+b.backgroundColor+"'><div class='bglayerinner'  ><img border='0' alt='background' /></div></div>");c.append("<div class='medialayer' ></div>");c.append("<div class='albumlist'><div class='start'><div class='starttext'>"+b.startDiscoverty+"</div><div class='albumindex'>0 of 0</div></div><div class='line'></div></div>");c.append("<div class='loading' />");
c.append("<div class='lightbox'><div class='lbouter'><div class='lbinner' /><div class='info'><div class='title'></div><div class='description'></div><a class='more'></a></div><a class='close' /></a></div></div>");var H=c.find(".albumlist"),S=c.find(".albumindex"),W=c.find(".start"),Q=c.find(".albumlist .line"),m=c.find(".medialayer"),G=c.find(".bglayer"),z=c.find(".bglayerinner"),n=c.find(".loading"),e=c.find(".lightbox"),j=c.find(".lbouter"),l=c.find(".lbinner"),h=c.find(".info"),X=c.find(".close"),
w=c.find(".more"),I=c.attr("ID"),s=-1,L=(c.height()-H.height())/b.rows,K=c.width()/b.columns,A=6,M,N,D,C=-1,U=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)?!0:!1;(function(){var a=o.length;10<a&&(a=10);for(var b=W.width(),i=(Q.width()-b)/a,e=0;e<a;e++){var h=i*e+i/2,j=f("<a href='javascript:void(0);' class='category' data-index='"+e+"'><span class='categorylabel'>"+f(o[e]).attr("data-title")+"</span><span class='shadow' /></a>");Q.append(j);
j.css("left",b+h-j.width()/2)}c.find(".category").click(function(){var a=f(this).attr("data-index");y(a)})})();if(0<o.length)if(0<b.defaultAlbum)for(var x=0;x<o.length;x++)if(f(o[x]).attr("data-umgid")==b.defaultAlbum){y(x);break}else x==o.length-1&&y(0);else y(0);n.hide();l.click(function(){E()});X.click(function(){E()});l.click(function(){E()});h.css("width",b.infoWidth);b.openLinkInNewWindow&&w.attr("target","_blank");b.lightboxBackground&&j.css("background-color","#"+b.lightboxBackground)})}})(jQuery);
