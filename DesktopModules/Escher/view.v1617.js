Type.registerNamespace("WinDoH.Escher");WinDoH.Escher.View=function(){WinDoH.Escher.View.initializeBase(this);this._msgs={};this._iRows=null;this._iColumns=null;this._sImageSyntax=null;this._sPageChangeJS=null;this._bCaptionDisplayTitle=null;this._bCaptionDisplayInline=null;this._bCaptionDisplayAbove=null;this._bCaptionDisplayPolaroid=null;this._bCaptionTitle=null;this._bCaptionDesc=null;this._imagesPanel=null;this._pagerControls=null;this._requestedPage=null;this._updateSuccessDelegate=Function.createDelegate(this,this._updateSuccess);this._updateFailDelegate=Function.createDelegate(this,this._updateFail);this._loadDataDelegate=Function.createDelegate(this,this._loadData);this._onLoadDelegate=Function.createDelegate(this,this._onLoad);Sys.Application.add_load(this._onLoadDelegate)};WinDoH.Escher.View.prototype={get_ns:function(a){return this.get_id()+"_"+a},get_msgs:function(){return this._msgs},set_msgs:function(a){this._msgs=Sys.Serialization.JavaScriptSerializer.deserialize(a)},get_iRows:function(){return this._iRows},set_iRows:function(a){this._iRows=a},get_iColumns:function(){return this._iColumns},set_iColumns:function(a){this._iColumns=a},get_sImageSyntax:function(){return this._sImageSyntax},set_sImageSyntax:function(a){this._sImageSyntax=a},get_sPageChangeJS:function(){return this._sPageChangeJS},set_sPageChangeJS:function(a){this._sPageChangeJS=a},get_bCaptionDisplayTitle:function(){return this._bCaptionDisplayTitle},set_bCaptionDisplayTitle:function(a){this._bCaptionDisplayTitle=a},get_bCaptionDisplayInline:function(){return this._bCaptionDisplayInline},set_bCaptionDisplayInline:function(a){this._bCaptionDisplayInline=a},get_bCaptionDisplayAbove:function(){return this._bCaptionDisplayAbove},set_bCaptionDisplayAbove:function(a){this._bCaptionDisplayAbove=a},get_bCaptionDisplayPolaroid:function(){return this._bCaptionDisplayPolaroid},set_bCaptionDisplayPolaroid:function(a){this._bCaptionDisplayPolaroid=a},get_bCaptionTitle:function(){return this._bCaptionTitle},set_bCaptionTitle:function(a){this._bCaptionTitle=a},get_bCaptionDesc:function(){return this._bCaptionDesc},set_bCaptionDesc:function(a){this._bCaptionDesc=a},initialize:function(){WinDoH.Escher.View.callBaseMethod(this,"initialize");this._pagerControls=$get(this.get_ns("PagerControls"));this._imagesPanel=$get(this.get_ns("pImages"));if(this._pagerControls){$addHandlers(this._pagerControls,{click:this._onPageChange},this)}},_onLoad:function(){if(this._pagerControls){var a=this;$(document).ready(function(){var e=jQuery("#"+a._pagerControls.id+" .ohPrevPage").width();var d=jQuery("#"+a._pagerControls.id+" .ohNextPage").width();var b=a._imagesPanel.clientWidth;if(e==0){e=d+30}if(d==0){d=e}var c=b-d-e;jQuery("#"+a._pagerControls.id+" .escher-pager-numbers").removeClass("ohHidden").scrollLeft(0)})}},_onPageChange:function(k,f){k.preventDefault();k.stopPropagation();if(k.target.tagName=="A"){this._requestedPage=k.target.getAttribute("startIndex");jQuery("#"+this._pagerControls.id+" .escher-currentpage").removeClass("escher-currentpage");jQuery(k.target).addClass("escher-currentpage");var j=jQuery(k.target).index()+1;var i=jQuery(k.target).attr("startindex");var l=this._iRows*this._iColumns;var c=jQuery("#"+this._pagerControls.id+" .escher-pager-numbers").children().length;var a=((i-1)/l)+1;var d=Math.floor(c/2);var m=jQuery("#"+this._pagerControls.id+" .escher-pager-numbers").data("totalpages");var h=this;if(c>=m){jQuery("#"+h._pagerControls.id+" .escher-currentpage").removeClass("escher-currentpage");jQuery(k.target).addClass("escher-currentpage")}else{var g=false;var e=d;var b=false;jQuery("#"+this._pagerControls.id+" .escher-pager-numbers").children().each(function(p,o){var q=a-d+p;if(b==false&&(q-1)+c>m){e=(m-((q-1)+c));g=true}b=true;if(q<1&&g==false){g=true;if(q==0){e=1}}if(g){q=q+e}var n=(q-1)*l+1;jQuery(this).text(q);jQuery(this).attr("startindex",n);if(q==a){jQuery("#"+h._pagerControls.id+" .escher-currentpage").removeClass("escher-currentpage");jQuery(this).addClass("escher-currentpage")}})}this._displayWait(true,this._loadDataDelegate)}},getMessage:function(a){return this._msgs[a]},_createChildControl:function(a,b,c){var d=document.createElement(a);if(b){d.id=this.get_ns(b)}if(c){d.type=c}return d},_createImage:function(f,a,g,d){link=this._createChildControl("a");link.href=a;var c="";if(g&&d&&this._bCaptionTitle&&this._bCaptionDesc){c=g+"&mdash;"+d}else{if(g&&this._bCaptionTitle){c=g}else{if(d&&this._bCaptionDesc){c=d}}}if(this._bCaptionDisplayTitle){link.title=c}var e=null;for(var b=0;b<this.get_sImageSyntax().length;b++){e=this.get_sImageSyntax()[b].split("=");link.setAttribute(e[0],e[1])}img=this._createChildControl("img");img.src=f;img.border=0;if(this._bCaptionDisplayTitle&&this._bCaptionDisplayAbove){aboveImg=this._createChildControl("span");aboveImg.innerHTML=c;link.appendChild(aboveImg)}link.appendChild(img);if(this._bCaptionDisplayTitle&&this._bCaptionDisplayPolaroid){polaroidImg=this._createChildControl("span");polaroidImg.innerHTML=c;link.appendChild(polaroidImg)}return link},_loadData:function(){dnn.xmlhttp.callControlMethod("WinDoH.Escher.View."+this.get_id(),"LoadData",{startIndex:this._requestedPage,maxResults:this._iRows*this._iColumns},this._updateSuccessDelegate,this._updateFailDelegate)},_updateSuccess:function(payload,ctx,req){if(payload){var $firstPage=jQuery("#"+this._pagerControls.id+" .ohFirstPage");var $lastPage=jQuery("#"+this._pagerControls.id+" .ohLastPage");var $prevPage=jQuery("#"+this._pagerControls.id+" .ohPrevPage");var $nextPage=jQuery("#"+this._pagerControls.id+" .ohNextPage");$prevPage.attr("startIndex",payload.Start-payload.Size);$nextPage.attr("startIndex",payload.Start+payload.Size);var totalSum=payload.Start+payload.Size-1;totalSum=(totalSum>payload.Total?payload.Total:totalSum);$get(this.get_ns("lPageInfo")).innerHTML=String.format(this.getMessage("PageInfo"),payload.Start,totalSum,payload.Total);if(totalSum==payload.Total){$nextPage.hide();$lastPage.hide()}else{$nextPage.show();$lastPage.show()}if(totalSum+payload.Size>=payload.Total){$lastPage.hide()}if(payload.Start>payload.Size+1){$firstPage.show()}else{$firstPage.hide()}if(payload.Start==1){$prevPage.hide()}else{$prevPage.show()}var tbody=this._createChildControl("tbody");tbody.className="escher-content";tbody.setAttribute("style","display:none;");var col=this._iColumns;var c_row=0;var c_col=0;for(var i=0;i<payload.Rows.length;i++){var c2=c_col%col;if(c2==0&&c_col!=0){c_row++;c_col=0;tbody.appendChild(row_current);row_current=this._createChildControl("tr")}else{if(c_row==0&&c_col==0&&c2==0){row_current=this._createChildControl("tr")}}c_col++;cell_current=this._createChildControl("td");cell_current.appendChild(this._createImage(payload.Rows[i].Thumb,payload.Rows[i].Full,payload.Rows[i].Name,payload.Rows[i].Desc));if(this._bCaptionDisplayInline){txt=this._createChildControl("span");if(payload.Rows[i].Name&&payload.Rows[i].Desc&&this._bCaptionTitle&&this._bCaptionDesc){txt.innerHTML=payload.Rows[i].Name+"&mdash;"+payload.Rows[i].Desc}else{if(payload.Rows[i].Name&&this._bCaptionTitle){txt.innerHTML=payload.Rows[i].Name}else{if(payload.Rows[i].Desc&&this._bCaptionDesc){txt.innerHTML=payload.Rows[i].Desc}}}cell_current.appendChild(txt)}row_current.appendChild(cell_current)}tbody.appendChild(row_current);jQuery("#"+this.get_ns("pImages")+" tbody").replaceWith(tbody);if(this.get_sPageChangeJS().length>0){eval(this.get_sPageChangeJS())}}this._displayWait(false)},_updateFail:function(a,c,b){this._displayWait(false);alert("error: "+a)},_displayWait:function(a,c){if(a){var b=jQuery("#"+this._imagesPanel.id);b.css("height",b.height()).css("width",b.width());jQuery("#"+this.get_ns("pLoading")).removeClass("ohHidden");jQuery("#"+this._imagesPanel.id+" .escher-content").fadeOut(400,c())}else{jQuery("#"+this.get_ns("pLoading")).addClass("ohHidden");jQuery("#"+this._imagesPanel.id+" .escher-content").fadeIn(300)}},dispose:function(){if(this._pagerControls){$clearHandlers(this._pagerControls)}this._msgs={};this._iRows=null;this._iColumns=null;this._sImageSyntax=null;this._sPageChangeJS=null;this._bCaptionDisplayTitle=null;this._bCaptionDisplayInline=null;this._bCaptionDisplayAbove=null;this._bCaptionDisplayPolaroid=null;this._bCaptionTitle=null;this._bCaptionDesc=null;this._imagesPanel=null;this._pagerControls=null;this._requestedPage=null;this._loadDataDelegate=null;this._updateSuccessDelegate=null;this._updateFailDelegate=null}};WinDoH.Escher.View.registerClass("WinDoH.Escher.View",Sys.Component);